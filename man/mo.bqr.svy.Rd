% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mo.bqr.svy.R
\name{mo.bqr.svy}
\alias{mo.bqr.svy}
\title{Multiple-Output Bayesian Quantile Regression for Complex Surveys (EM)}
\usage{
mo.bqr.svy(
  formula,
  weights = NULL,
  data,
  quantile = 0.5,
  algorithm = "em",
  prior = NULL,
  n_dir = 1,
  epsilon = 1e-06,
  max_iter = 1000,
  verbose = FALSE,
  niter = NULL,
  burnin = NULL,
  thin = NULL,
  ...
)
}
\arguments{
\item{formula}{An object of class \code{\link{formula}} specifying the model.}

\item{weights}{Optional survey weights. Can be a numeric vector of length equal
to the number of observations. Weights are normalized internally and do not
require any preprocessing.}

\item{data}{A \code{data.frame} containing the variables in the model.}

\item{quantile}{Numeric vector of quantiles in (0, 1) to estimate. Multiple
quantiles can be passed.}

\item{algorithm}{Character string; currently only \code{"em"} is implemented.}

\item{prior}{Prior specification. Can be:
\itemize{
\item A \code{mo_bqr_prior} object from \code{\link{mo_prior_default}}
\item A list with components \code{beta_mean}, \code{beta_cov}, \code{sigma_shape}, \code{sigma_rate}
\item \code{NULL} (uses default vague priors)
}
Contains:
\describe{
\item{\code{beta_mean}}{Prior mean vector for regression coefficients.}
\item{\code{beta_cov}}{Prior covariance matrix for regression coefficients.}
\item{\code{sigma_shape}}{Shape parameter for inverse-gamma prior on \eqn{\sigma^2}.}
\item{\code{sigma_rate}}{Rate parameter for inverse-gamma prior on \eqn{\sigma^2}.}
}
If \code{NULL}, a default vague prior is used (\code{\link{mo_prior_default}}).}

\item{n_dir}{Integer; number of directional quantiles to estimate (default 1).}

\item{epsilon}{Convergence tolerance for EM.}

\item{max_iter}{Maximum number of EM iterations.}

\item{verbose}{Logical; if \code{TRUE}, prints progress messages.}

\item{niter, burnin, thin}{Ignored for EM, but included for compatibility with MCMC
interfaces.}

\item{...}{Additional arguments (currently unused).}
}
\value{
An object of class \code{"mo.bqr.svy"}, which is a list containing:
\describe{
\item{\code{call}}{Matched call.}
\item{\code{formula}}{Model formula.}
\item{\code{terms}}{Model terms object.}
\item{\code{quantile}}{Quantile levels estimated.}
\item{\code{algorithm}}{Algorithm used.}
\item{\code{prior}}{Prior specification used.}
\item{\code{fit}}{List of fitted results for each quantile.}
\item{\code{coefficients}}{Vector of coefficients for the first quantile.}
\item{\code{n_dir}}{Number of directional quantiles estimated.}
}
}
\description{
Fits a multiple-output Bayesian quantile regression model under complex survey
weights using the Expectation-Maximization (EM) algorithm implemented in C++.
Currently only the \code{"em"} algorithm is supported. Survey weights are
normalized internally (divided by their mean).
}
\details{
The EM algorithm iteratively maximizes the posterior mode under the specified
prior distribution. For each quantile \eqn{\tau}, the weighted check loss is
minimized under Bayesian regularization.

\strong{Prior Specification:}

The prior can be specified in several ways:
\enumerate{
\item Using \code{\link{mo_prior_default}} (recommended):
\preformatted{
  prior <- mo_prior_default(
    p            = 3,                             # number of coefficients
    beta_mean    = c(0, 1.4, -0.7),               # prior means
    beta_cov     = diag(c(0.25, 0.25, 0.25)),     # prior covariance matrix
    sigma_shape  = 2,                             # IG shape parameter
    sigma_rate   = 1,                             # IG rate parameter
    names        = c("(Intercept)", "x1", "x2")
  )}

\item As a list:
\preformatted{
  prior <- list(
    beta_mean    = c(0, 1.4, -0.7),
    beta_cov     = diag(c(0.25, 0.25, 0.25)),
    sigma_shape  = 2,
    sigma_rate   = 1
  )}

\item \code{NULL} for default vague priors
}
}
\examples{
# Basic usage with default priors
sim <- simulate_mo_bqr_data(n = 50, p = 2)
fit1 <- mo.bqr.svy(y ~ x1 + x2, weights = sim$weights, data = sim$data,
                   quantile = c(0.1, 0.5, 0.9), algorithm = "em",
                   max_iter = 200)

# With informative priors  
prior <- mo_prior_default(
  p            = 3,  # intercept + two slopes
  beta_mean    = c(1, 1, 2),                    # prior means
  beta_cov     = diag(c(1, 0.5, 0.5)),          # prior covariances
  sigma_shape  = 3,                             # more concentrated IG
  sigma_rate   = 2
)
fit2 <- mo.bqr.svy(y ~ x1 + x2, weights = sim$weights, data = sim$data,
                   quantile = c(0.25, 0.5, 0.75), algorithm = "em",
                   prior = prior, max_iter = 300, verbose = TRUE)


}
\seealso{
\code{\link{mo_prior_default}}, \code{\link{as_mo_bqr_prior}},
\code{\link{bqr.svy}}, \code{\link{simulate_mo_bqr_data}}
}
